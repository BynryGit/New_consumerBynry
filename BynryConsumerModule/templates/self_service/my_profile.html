<!DOCTYPE html>

<html lang="en">
<!-- BEGIN HEAD -->
{% load staticfiles %}
<head>
    <meta charset="utf-8"/>
    <title> New User Registration | Bynry</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="" name="author"/>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet"
          type="text/css"/>
    <link href="{% static 'assets/global/plugins/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet"
          type="text/css"/>
    <link href="{% static 'assets/global/plugins/simple-line-icons/simple-line-icons.min.css' %}" rel="stylesheet"
          type="text/css"/>
    <link href="{% static 'assets/global/plugins/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/global/plugins/uniform/css/uniform.default.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css' %}" rel="stylesheet"
          type="text/css"/>
    <link href="{% static 'assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css' %}" rel="stylesheet"
          type="text/css"/>
    <link href="{% static 'assets/global/css/components.min.css' %}" rel="stylesheet" id="style_components"
          type="text/css"/>
    <link href="{% static 'assets/global/css/plugins.min.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/pages/css/profile.min.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/layouts/layout3/css/layout.min.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/layouts/layout3/css/themes/default.min.css' %}" rel="stylesheet" type="text/css"
          id="style_color"/>
    <link href="{% static 'assets/layouts/layout3/css/custom.min.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/global/plugins/select2/css/select2.min.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/global/plugins/select2/css/select2-bootstrap.min.css' %}" rel="stylesheet"
          type="text/css"/>

</head>
<!-- END HEAD -->
<style>
		#loading{
		    width: 36%;
		    height: 44px;
		    position: absolute;
		    top: 26%;
		    left: 32%;
		    margin: -28px 0px 0px -25px;
		    text-align: center;
		    font-size: 13px;
		    font-weight: 500;
		    color: #000;
		}		

</style>
<body class="page-container-bg-solid page-boxed">
<!-- BEGIN HEADER -->
<div class="page-header">
    <!-- BEGIN HEADER TOP -->
    <div class="page-header-top">
        <div class="container">
            <!-- BEGIN LOGO -->
            <div class="page-logo">
                <a href="index.html">
                    <img style="width: 101px; margin-top: 9px"
                         src="{% static 'assets/layouts/layout3/img/Bynry_small_black-logo.png' %}" alt="logo"
                         class="logo-default">
                </a>
            </div>
            <!-- END LOGO -->
            <!-- BEGIN RESPONSIVE MENU TOGGLER -->
            <a href="javascript:;" class="menu-toggler"></a>
            <!-- END RESPONSIVE MENU TOGGLER -->
            <!-- BEGIN TOP NAVIGATION MENU -->
            <div class="top-menu">
                {% if request.session.login_user %}
                <ul class="nav navbar-nav pull-right">
                    <li class="dropdown dropdown-user dropdown-dark">
                        <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown"
                           data-close-others="true">
                            <img alt="" class="img-circle" src="{{request.session.profile_image}}" style="width: 45px;">
                            <span class="username username-hide-mobile">{{request.session.login_user}} ({{request.session.consumer_no}})</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-default">
                            <li>
                                <a href="/self-service/my-profile/">
                                    <i class="icon-user"></i> My Profile </a>
                            </li>
                            <li>
                                <a href="/self-service/manage-accounts/">
                                    <i class="icon-user"></i> Manage Account </a>
                            </li>
                            <li>
                                <a href="/self-service/logout/">
                                    <i class="icon-key"></i> Log Out </a>
                            </li>
                        </ul>
                    </li>
                </ul>
                {%else%}
                <a class="nav navbar-nav pull-right" href="/self-service/login/">
                    <i class="icon-login"></i> Login </a>
                {% endif %}
            </div>
            <!-- END TOP NAVIGATION MENU -->
        </div>
    </div>
    <!-- END HEADER TOP -->
    <!-- BEGIN HEADER MENU -->
    <div class="page-header-menu">
        <div class="container">
            <!-- BEGIN MEGA MENU -->
            <div class="hor-menu  ">
                {% include 'self_service/side-panel.html' %}

            </div>
            <!-- END MEGA MENU -->
        </div>
    </div>
    <!-- END HEADER MENU -->
</div>
<!-- END HEADER -->
<!-- BEGIN CONTAINER -->
<div class="page-container">
    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
        <!-- BEGIN CONTENT BODY -->
        <!-- BEGIN PAGE HEAD-->
        <div class="page-head">
            <div class="container">
                <!-- BEGIN PAGE TITLE -->
                <div class="page-title">
                    <h1>My Profile
                    </h1>
                </div>
                <!-- END PAGE TITLE -->
            </div>
        </div>
        <!-- END PAGE HEAD-->
        <!-- BEGIN PAGE CONTENT BODY -->
        <div class="page-content">
            <div class="container">
                <!-- BEGIN PAGE CONTENT INNER -->
                <div class="page-content-inner">
                    <div class="row">
                        <div class="col-md-12">
                            <!-- BEGIN PROFILE CONTENT -->
                            <div class="profile-content">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="portlet light ">
                                            <div class="portlet-body">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="col-md-3">																					
						                                           <div class="form-group">
	                                                            <div class="fileinput fileinput-new" data-provides="fileinput">
	                                                                <div class="fileinput-new thumbnail" style="width: 200px; height: 150px;">
	                                                                    <img src="{{profile_image}}" alt="" / > </div>
	                                                                <div class="fileinput-preview fileinput-exists thumbnail" style="max-width: 200px; max-height: 150px;"> </div>
	                                                                <div>
	                                                                    <span class="btn default btn-file">
	                                                                        <span class="fileinput-new"> Select image </span>
	                                                                        <span class="fileinput-exists"> Change </span>
	                                                                        <input type="file" name="..." id="profile_image"> </span>
	                                                                    <a href="javascript:;" class="btn default fileinput-exists" data-dismiss="fileinput"> Remove </a>
	                                                                </div>
	                                                            </div>	                                                            
	                                                        </div>
                                                        </div>
                                                        <div class="col-md-9">
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <div class="caption caption-md">
                                                                        <i class="icon-globe theme-font hide"></i>
                                                                        <span class="caption-subject font-blue-madison bold uppercase">Profile Details</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <br>
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <div class="form-group">
                                                                        <label class="col-md-3 control-label">Name</label>
                                                                        <div class="col-md-4">
                                                                            <input type="text" class="form-control"
                                                                                   id="user_name" value="{{name}}">
                                                                            <label id="user_name_error" class="error"
                                                                                   style="color:red; display:none; font-size: 12px;"></label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <br>
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <div class="form-group">
                                                                        <label class="col-md-3 control-label">Mobile
                                                                            No.</label>
                                                                        <div class="col-md-4">
                                                                            <input type="text" class="form-control"
                                                                                   id="mobile_no"
                                                                                   value="{{contact_no}}">
                                                                            <label id="mobile_no_error" class="error"
                                                                                   style="color:red; display:none; font-size: 12px;"></label>
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                            <br>
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <div class="form-group">
                                                                        <label class="col-md-3 control-label">Email
                                                                            Address</label>
                                                                        <div class="col-md-4">
                                                                            <div class="input-group">
				                                                                    <span class="input-group-addon">
				                                                                        <i class="fa fa-envelope"></i>
				                                                                    </span>
                                                                                <input type="email" class="form-control"
                                                                                       id="email_add"
                                                                                       value="{{email_id}}">
                                                                            </div>
                                                                            <label id="email_add_error" class="error"
                                                                                   style="color:red; display:none; font-size: 12px;"></label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <br>
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <div class="caption caption-md">
                                                                        <i class="icon-globe theme-font hide"></i>
                                                                        <span class="caption-subject font-blue-madison bold uppercase">Change Password</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <br>
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <div class="form-group">
                                                                        <label class="col-md-3 control-label">Old
                                                                            Password</label>
                                                                        <div class="col-md-4">
                                                                            <div class="input-group">
                                                                                <input type="password"
                                                                                       class="form-control"
                                                                                       placeholder="Password"
                                                                                       id="old_pass">
                                                                                <span class="input-group-addon">
				                                                                        <i class="fa fa-user"></i>
				                                                                    </span>
                                                                            </div>
                                                                            <label id="old_pass_error" class="error"
                                                                                   style="color:red; display:none; font-size: 12px;"></label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <br>
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <div class="form-group">
                                                                        <label class="col-md-3 control-label">New
                                                                            Password</label>
                                                                        <div class="col-md-4">
                                                                            <div class="input-group">
                                                                                <input type="password"
                                                                                       class="form-control"
                                                                                       placeholder="Password"
                                                                                       id="new_pass">
                                                                                <span class="input-group-addon">
				                                                                        <i class="fa fa-user"></i>
				                                                                    </span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <br>
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <div class="form-group">
                                                                        <label class="col-md-3 control-label">Confirm
                                                                            Password</label>
                                                                        <div class="col-md-4">
                                                                            <div class="input-group">
                                                                                <input type="password"
                                                                                       class="form-control"
                                                                                       placeholder="Password"
                                                                                       id="confirm_pass">
                                                                                <span class="input-group-addon">
				                                                                        <i class="fa fa-user"></i>
				                                                                    </span>
                                                                            </div>
                                                                            <label id="new_pass_error" class="error"
                                                                                   style="color:red; display:none; font-size: 12px;"></label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-12"
                                                                     style="text-align: right;margin-top: 36px;">
                                                                    <div class="form-actions top">
                                                                        <div class="row">
                                                                            <div class="col-md-offset-3 col-md-9">
                                                                                <button type="submit" class="btn green"
                                                                                        id="save-changes">Save Changes
                                                                                </button>
                                                                               <a href="/self-service/"> <button type="button"
                                                                                        class="btn default">Cancel
                                                                                </button></a>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>                                                        
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END PROFILE CONTENT -->
    </div>
</div>

<div class="modal fade draggable-modal" id="success_modal" tabindex="-1" role="basic" aria-hidden="true">
    <div class="modal-dialog" style="width:35%;">
        <div class="modal-content">
            <div class="modal-header text-center">

                <img style="width: 18%;"
                     src="{% static 'assets/layouts/layout3/img/Bynry_small_black-logo.png' %}" alt="logo"
                     class="logo-default">

            </div>
            <div class="modal-body">
                <form action="index.html" class="form-horizontal form-row-seperated">
                    <div class="form-body">
                        <h4 class="text-center">User updated successfully</h4>
                    </div>
                    <div style="text-align:center !important;" class="modal-footer">
                        <a type="button" href="/self-service/" class="btn green">OK</a>

                    </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
</div>

<div style="overflow-y:hidden;" id="error-modal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <img style="width: 100px; height: 29px; margin-top: -11px; margin-left: 236px;"
                     src="{% static 'assets/layouts/layout3/img/Bynry_small_black-logo.png' %}" alt="logo"
                     class="logo-default">

            </div>
            <div class="modal-body">
                <div class="form-body">
                    <h4 class="text-center">Old Password is not matching </h4>
                </div>
                <div style="text-align:center !important;" class="modal-footer">
                    <input data-dismiss="modal" type="submit" value="OK"
                           class="btn btn-primary" id="btn-loading-demo">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- BEGIN FOOTER -->
<div class="page-footer">
    <div class="container"> 2017 &copy; Bynry Technologies India Pvt. Ltd.
    </div>
</div>
<div class="scroll-to-top">
    <i class="icon-arrow-up"></i>
</div>
<!-- END FOOTER -->
<!-- BEGIN CORE PLUGINS -->
<script src="{% static 'assets/global/plugins/jquery.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/bootstrap/js/bootstrap.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/js.cookie.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js' %}"
        type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js' %}"
        type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/jquery.blockui.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/uniform/jquery.uniform.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js' %}"
        type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js' %}"
        type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/jquery.sparkline.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/scripts/app.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/pages/scripts/profile.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/layouts/layout3/scripts/layout.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/layouts/layout3/scripts/demo.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/layouts/global/scripts/quick-sidebar.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/select2/js/select2.full.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/pages/scripts/components-select2.min.js' %}" type="text/javascript"></script>
<!-- END THEME LAYOUT SCRIPTS -->

<script type="text/javascript">


function validate_data() {
	if (checkName("#user_name")&checkContactNo("#mobile_no")&checkBillEmail("#email_add")&checkPassword()) {

		return true 
 	}
 	return false
}
function checkPassword() {
	 if ($('#old_pass').val() != '' || $('#new_pass').val() != '' || $('#confirm_pass').val() != '') {
				if (check_oldPass("#old_pass") & check_newPass()) {
					return true
				}
				else {
					return false
				}
		}
		else {
			return true
		}		
}
$("#save-changes").click(function(event)  {

  if (validate_data()) {

		event.preventDefault(); 
		var input = document.getElementById("profile_image");  	  
		file = input.files[0];

		var formData= new FormData();
		formData.append("user_name",$("#user_name").val());
		formData.append("mobile_no",$("#mobile_no").val());
		formData.append("email_add",$("#email_add").val());
		formData.append("old_pass",$("#old_pass").val());		
		formData.append("new_pass",$("#new_pass").val());
		formData.append("profile_image",file)

	 	$.ajax({  				  
			  type	: "POST",
			   url : '/self-service/save-profile/',
	 			data : formData,
				cache: false,
		      processData: false,
		 		contentType: false, 
		 			               
	        success: function (response) {   
	           if(response.success=='true'){
						$("#success_modal").modal('show');
	           	}
	   			if (response.success == "false") {	   		
						$("#error-modal").modal('show');
	    			}							                        		                      		                       		
	         },
	         	beforeSend: function () {
	          $("#processing").css('display','block');
	      },
	      complete: function () {
	          $("#processing").css('display','none');
	      },
	         error : function(response){
	            	alert("_Error");
	      	}              
	  });  
	}       
});     

function checkName(applicant_name){
 	var namePattern = /[A-Za-z]+/;  
	applicant_name = $(applicant_name).val()  
   if(namePattern.test(applicant_name)){
 		$(user_name_error).css("display", "none");
   	return true;
   }else{
    	$(user_name_error).css("display", "block");
    	$(user_name_error).text("Please enter valid User Name");
   	return false; 
   }
}
function checkContactNo(mobile){
    mobile = $(mobile).val()     
   var phoneNumberPattern = /^[789]\d{9}$/; 
   if(phoneNumberPattern.test(mobile)){
    $(mobile_no_error).parent().children('.error').css("display", "none");
   return true;
   }else{
    $(mobile_no_error).parent().children('.error').css("display", "block");
    $(mobile_no_error).parent().children('.error').text("Please enter valid Mobile Number");
   return false; 
   }
}
function checkBillEmail(email){
	Email = $(email).val()
   var namePattern = /[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$/;  
   if(Email=='')
	{
   $(email_add_error).css("display", "none");
	return true;	
	}  
   else if(namePattern.test(Email)){
      $(email_add_error).css("display", "none");
   return true;
   }else{
 	$(email_add_error).css("display", "block");
   $(email_add_error).text("Please enter valid email");
   return false; 
   }
}

function check_oldPass(password){
 passw = $(password).val()
 var paswd=  /^[a-zA-Z0-9!@#$%^&*]{6,15}$/;

	if($(password).val()!='' && paswd.test(passw))
   {
    $("#old_pass_error").css("display", "none");
  	 return true;
   }
   else{
     $("#old_pass_error").css("display", "block");
     $("#old_pass_error").text("Enter valid Old Password");
     return false; 
   }
}
function check_newPass(){

	var password = $('#new_pass').val();
 		var re_password = $('#confirm_pass').val();
   if (password != re_password) {
 			 $('#new_pass_error').css("display", "block");
          $('#new_pass_error').text("Password doesn't match");
 				 return false;	
 		 }
 	passw = $('#new_pass').val()
 	var paswd=  /^[a-zA-Z0-9!@#$%^&*]{6,15}$/;

	if(passw !='' && paswd.test(passw))
   {
    $("#new_pass_error").css("display", "none");
  	 return true;
   }
   else{
     $("#new_pass_error").css("display", "block");
     $("#new_pass_error").text("Enter valid New Password more than six character");
     return false; 
   }
}


</script>
</body>
</html>